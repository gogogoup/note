<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Javascript | doFun</title>
    <meta name="generator" content="VuePress 1.4.1">
    
    <meta name="description" content="be water my friend">
    <link rel="preload" href="/note/assets/css/0.styles.06ad8ea8.css" as="style"><link rel="preload" href="/note/assets/js/app.2e5e5d15.js" as="script"><link rel="preload" href="/note/assets/js/2.0d9fcc6c.js" as="script"><link rel="preload" href="/note/assets/js/18.984bce13.js" as="script"><link rel="prefetch" href="/note/assets/js/10.4020279d.js"><link rel="prefetch" href="/note/assets/js/11.98f21b9c.js"><link rel="prefetch" href="/note/assets/js/12.25bf1360.js"><link rel="prefetch" href="/note/assets/js/13.96901a78.js"><link rel="prefetch" href="/note/assets/js/14.fc5e00e8.js"><link rel="prefetch" href="/note/assets/js/15.7131b397.js"><link rel="prefetch" href="/note/assets/js/16.a6634466.js"><link rel="prefetch" href="/note/assets/js/17.a05d7a88.js"><link rel="prefetch" href="/note/assets/js/19.c5166816.js"><link rel="prefetch" href="/note/assets/js/20.d5aacbe4.js"><link rel="prefetch" href="/note/assets/js/21.93d62206.js"><link rel="prefetch" href="/note/assets/js/22.aa0aa2ea.js"><link rel="prefetch" href="/note/assets/js/23.31e27050.js"><link rel="prefetch" href="/note/assets/js/24.e846da92.js"><link rel="prefetch" href="/note/assets/js/25.480a41f4.js"><link rel="prefetch" href="/note/assets/js/26.96a87f01.js"><link rel="prefetch" href="/note/assets/js/27.ed072997.js"><link rel="prefetch" href="/note/assets/js/28.d0c806db.js"><link rel="prefetch" href="/note/assets/js/3.cdc5ffc6.js"><link rel="prefetch" href="/note/assets/js/4.fca74266.js"><link rel="prefetch" href="/note/assets/js/5.7ea98ef5.js"><link rel="prefetch" href="/note/assets/js/6.cecb269b.js"><link rel="prefetch" href="/note/assets/js/7.b8cf5606.js"><link rel="prefetch" href="/note/assets/js/8.eab8faa7.js"><link rel="prefetch" href="/note/assets/js/9.13153f45.js">
    <link rel="stylesheet" href="/note/assets/css/0.styles.06ad8ea8.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/note/" class="home-link router-link-active"><!----> <span class="site-name">doFun</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/note/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="/note/DailyShare/" class="nav-link">
  DailyShare
</a></div><div class="nav-item"><a href="/note/Writting/" class="nav-link">
  Writting
</a></div><div class="nav-item"><a href="https://github.com/gogogoup" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/note/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="/note/DailyShare/" class="nav-link">
  DailyShare
</a></div><div class="nav-item"><a href="/note/Writting/" class="nav-link">
  Writting
</a></div><div class="nav-item"><a href="https://github.com/gogogoup" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/note/计算机基础.html" class="sidebar-link">计算机基础</a></li><li><a href="/note/Javascript.html" class="active sidebar-link">Javascript</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/note/Javascript.html#数据类型" class="sidebar-link">数据类型</a></li><li class="sidebar-sub-header"><a href="/note/Javascript.html#扫雷原理" class="sidebar-link">扫雷原理</a></li><li class="sidebar-sub-header"><a href="/note/Javascript.html#虚拟dom和diff算法" class="sidebar-link">虚拟dom和diff算法</a></li><li class="sidebar-sub-header"><a href="/note/Javascript.html#js存储数据到图片" class="sidebar-link">js存储数据到图片</a></li></ul></li><li><a href="/note/Css.html" class="sidebar-link">Css</a></li><li><a href="/note/Go.html" class="sidebar-link">Golang</a></li><li><a href="/note/C.html" class="sidebar-link">C</a></li><li><a href="/note/Git.html" class="sidebar-link">Git</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="javascript"><a href="#javascript" class="header-anchor">#</a> Javascript</h1> <p></p><div class="table-of-contents"><ul><li><a href="#数据类型">数据类型</a></li><li><a href="#扫雷原理">扫雷原理</a></li><li><a href="#虚拟dom和diff算法">虚拟dom和diff算法</a><ul><li><a href="#虚拟dom树">虚拟dom树</a></li><li><a href="#diff算法">diff算法</a></li></ul></li><li><a href="#js存储数据到图片">js存储数据到图片</a><ul><li><a href="#将字符串数据转成像素值">将字符串数据转成像素值</a></li><li><a href="#使用转换后的像素数据，绘图">使用转换后的像素数据，绘图</a></li><li><a href="#解析生成的图片为字符串">解析生成的图片为字符串</a></li></ul></li></ul></div><p></p> <h2 id="数据类型"><a href="#数据类型" class="header-anchor">#</a> 数据类型</h2> <h4 id="分类"><a href="#分类" class="header-anchor">#</a> 分类</h4> <p>基本数据类型和引用类型</p> <h4 id="_1-基本数据类型"><a href="#_1-基本数据类型" class="header-anchor">#</a> 1. 基本数据类型</h4> <p>null, undefined, boolean, number, string</p> <ul><li>基本数据类型是存在栈中</li> <li>基本数据类型是不可变的</li> <li>基本数据类型的比较是值的比较
<ul><li>比较是最好使用‘===’防止进行类型转换</li></ul></li></ul> <h4 id="_2-引用类型"><a href="#_2-引用类型" class="header-anchor">#</a> 2. 引用类型</h4> <p>object</p> <ul><li><p>放在堆内存中<br>
表示Object的变量其实是一个存在栈中的指针，指向堆内存的地址</p></li> <li><p>值可变</p></li> <li><p>引用类型的比较是引用的比较<br>
是比较指针是否指向同一个内存地址</p></li> <li><p>传值和传址</p> <ul><li>基本类型的赋值，是在内存中开辟新的一段栈内存，是传值</li> <li>引用类型的赋值是传址，只将变量（指针）指向赋值的对象，因此，改变两个变量指向同一个内存地址，一个发生了修改之后另一个也会修改</li></ul></li> <li><p>赋值，浅拷贝，深拷贝</p> <ul><li><img src="/note/2019-06-19-13-40-11.png" alt=""></li> <li>简单点总结一下就是：</li> <li>赋值是将新的变量指向原来引用对象，因此新的变量与原来指向相同内存地址的变量是完全相同的，改变任何一个都会导致别的也发生改变</li> <li>浅拷贝是将引用对象的第一层属性做了复制，如果属性的值是基本类型则是赋值，如果是引用类型则是传址，因此如果改变引用类型的属性值，原对象也会同时发生改变</li> <li>深拷贝是将引用对象的属性，子属性（子对象），均进行拷贝，这样即使属性值是引用类型，也会开辟新的内存地址存储，不会发生同时改变的情况</li></ul></li> <li><p>浅拷贝和深拷贝的实现</p> <ul><li>浅拷贝：遍历对象属性，赋值</li> <li>深拷贝：遍历对象属性，判断属性值是不是引用类型，是的话递归调用后赋值，不是的话直接赋值</li></ul></li></ul> <h2 id="扫雷原理"><a href="#扫雷原理" class="header-anchor">#</a> 扫雷原理</h2> <p>来源是codepen上一个扫雷项目：<a href="https://codepen.io/creme/pen/EqeXNJ" target="_blank" rel="noopener noreferrer">codepen<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a><br>
整理了下实现原理：</p> <p>最麻烦的几个地方：</p> <ol><li>怎么随机放置炸弹</li> <li>怎么做出点击某些格子，瞬间展开一大片的效果</li> <li>怎么确定某些点四周的雷的个数</li></ol> <p>过程：</p> <ol><li>创建n*n的格子</li> <li>遍历格子，此时进行n^2次遍历，每个遍历中，利用<code>Math.random() &lt; bombFrequency(0)</code>来确定当前格子是否表示为炸弹所在格子</li> <li>如果是炸弹，将该格子位置塞到表示炸弹位置的数组A中，将该格子周围8个格子（如果炸弹位置在边界则小于八个）的位置塞到一个数组B中</li> <li>将左键单击检查格子炸弹情况的事件1和右键单击标记格子是炸弹的事件2，绑定在每个格子上</li> <li>继续标记下一个格子，直到标记完成</li> <li>遍历数组B，每次出现一个格子位置，就在该格子上标记当前格子周围的炸弹数目+1</li> <li>到这一步，就完成了格子的布局和格子周围炸弹数量的标记</li> <li>事件1的处理：
<ul><li>获取当前格子的位置坐标，检查是否在炸弹列表中，如果是，就endGame；如果不是，继续</li> <li>检查当前格子上周围炸弹的数量，在点击完成后标记</li> <li>如果当前格子周围没有炸弹，就模拟点击周围8个位置的点，此时，如果这八个点中有和当前格子相同的情况，即周围没有格子，就会递归的再次模拟点击该格子周围的八个空白点，以此实现点击空白格子展开一大片的效果</li></ul></li> <li>获胜的处理：每次点击了格子，就去检查一下所有的格子是否被正确的标记或者点击，如果有炸弹的位置，没有被标记为checked，就可以判断为未检查，所以不获胜</li></ol> <h2 id="虚拟dom和diff算法"><a href="#虚拟dom和diff算法" class="header-anchor">#</a> 虚拟dom和diff算法</h2> <h3 id="虚拟dom树"><a href="#虚拟dom树" class="header-anchor">#</a> 虚拟dom树</h3> <p>是现在前端框架里面广泛在用的一个dom操作的方式。跟传统的jq相比，这个不会直接去操作对应的dom节点，而是把整个dom结构抽象成一个js中的object对象，在数据更新的时候diff一下新旧对象，再把object渲染成完整的dom结构<br>
这个优缺点很明显：</p> <ol><li>能保证性能下限，因为不管多少个节点更新，都只会做一次render，但这也是性能瓶颈，因为如果只有一个节点做了更改，整个页面都会进行一次重绘，在一些要求比较高的应用，比如vscode，他们就会直接操作dom，来代替部分虚拟dom的渲染</li> <li>兼容性更好，因为全是js的对象来保存dom结构信息，所以兼容性的处理统一由一个render函数处理了，贼拉方便</li> <li>不需要操作dom了，会把开发者的注意力集中到处理数据和逻辑上，效率会更高</li> <li>因为出现了虚拟dom的渲染方式，所以nodejs做服务端渲染，变得更加方便，不再做模版解析。而且这个也可以跨平台，比如小程序，微信自定义了一种类似html的wxml，在render函数中，修改对应生成的节点类型，就可以兼容到小程序。</li></ol> <p><img src="/note/2019-08-20-11-18-06.png" alt=""><br>
所以更新问题就会被转换成了两颗树的比较问题。标准的diff算法的复杂度O(n^3)，在dom树上，可以做很多优化，最后可以降到O(n)<br>
主要是：不同类型的元素产生不同的树；同一层级的一组子节点可以通过唯一的key区分
<img src="/note/2019-08-20-11-18-26.png" alt=""><br>
也就是，只会对相同颜色的dom节点进行比较；如果节点不存在了，该节点和它的子节点都被删除，不做进一步的比较</p> <h3 id="diff算法"><a href="#diff算法" class="header-anchor">#</a> diff算法</h3> <p><img src="/note/2019-08-20-11-20-42.png" alt="">
并不是移动a和它的子节点，而是：createA，createB，createC，deleteA（old）<br>
抽象完成之后，变成这种结构：
<img src="/note/2019-08-20-12-53-03.png" alt=""></p> <ol><li>先比较最外层节点，其实是比较抽象时节点的key和sel，如果这俩都不一样，就直接替换了</li> <li>上一步如果相同，则会把旧节点的el赋值到新节点上，让它指向同一个对象，保证对对象的修改会同步到新节点上。然后继续比较，如果新旧对象的引用相同，也就是内存地址都相同，就是相同的节点，可以跳过了；如果不同，再比较文本，如果文本相同，比较子节点</li> <li>子节点的情况再分成：新的有，旧的没有，就在老节点上添加；如果新节点没有，旧的有，就删除；如果都有，做更新</li> <li><img src="/note/2019-08-20-12-54-52.png" alt=""></li> <li>更新过程：oldCh和newCh各有两个头尾的变量StartIdx和EndIdx，它们的2个变量相互比较，一共有4种比较方式：
<ul><li>新的start和旧的start，相同时不进行dom移动</li> <li>新的end和旧的end，相同时不进行dom移动</li> <li>新的start和旧的end，相同时，说明旧的end跑到start前</li> <li>新的end和旧的start，相同时，说明旧的start跑到end后</li></ul></li> <li>在比较的过程中，变量会往中间靠，一旦StartIdx&gt;EndIdx表明oldCh和newCh至少有一个已经遍历完了，就会结束比较。</li> <li>结束时分成两种
<ul><li>oldStartIdx &gt; oldEndIdx：newStartIdx和newEndIdx之间就是新增的了，直接插入</li> <li>newStartIdx &gt; newEndIdx：oldStartIdx和oldEndIdx之间就是需要删除的</li></ul></li></ol> <h2 id="js存储数据到图片"><a href="#js存储数据到图片" class="header-anchor">#</a> js存储数据到图片</h2> <p>问题来源于自己做的chromeExtension工具中，受限于Chrome提供的api中没有文件写入的相关api，不能存储todo的数据。而直接存储数据，总觉得不够帅气。<br>
偶然看到有选手利用图片压缩数据的思路，就尝试把todo数据塞到图片，然后提供下载和解析功能，完成数据的导出导入。具体思路是：</p> <h3 id="将字符串数据转成像素值"><a href="#将字符串数据转成像素值" class="header-anchor">#</a> 将字符串数据转成像素值</h3> <p>因为每个像素值的四个通道值范围是0-255，也就是8位二进制值，所以需要将字符串的每个字符做utf8编码，然后转十进制，得到0-255之间的值。</p> <ul><li>如果字符是单字节，直接获取unicode码点</li> <li>如果是多字节字符，有两种方式
<ul><li>获取到字符unicode，照着utf8编码规则，几个if下去，判断出范围，拆成对应的多个字节</li> <li><code>encodeURI</code>会对传入字符做utf8编码转义，%作为间隔符号，得到字符拆成多字节后的16进制值，然后parseInt(&quot;xxx&quot;, 16)获取到10进制数据</li></ul></li></ul> <h3 id="使用转换后的像素数据，绘图"><a href="#使用转换后的像素数据，绘图" class="header-anchor">#</a> 使用转换后的像素数据，绘图</h3> <h4 id="alpha通道不能传值"><a href="#alpha通道不能传值" class="header-anchor">#</a> alpha通道不能传值</h4> <p>单个像素的四个通道，如果都设置了，在生成图片后再解析，会有偏差。<br>
原因是：浏览器对像素的合成做<code>premultiplied alpha</code>处理，会在合成的之前，对像素的rgb通道乘以透明度</p> <ul><li>举例：两个像素的图片，左边是纯红色rgba(255,0,0,1)，右边是有透明度的绿色rgba(0,255,0,0.1)。当把图片缩放到1x1的时候，最后合成的像素是左右两个像素插值的结果，也就是各个通道值相加除2
<ul><li>straignt alpha： rgba(127,127,0,0.55)</li> <li>premultiplied alpha: rgba(127,25,0,0.55)</li> <li><img src="/note/2019-12-17-14-22-04.png" alt=""></li> <li>straignt alpha的绿色会更重，因为在插值的时候没有乘透明度，而透明度是会影响所以通道值的，这样会导致像素插值的时候失真<br>
没有办法修改浏览器的默认行为。解决方式是把alpha通道值全部设成255，也就是alpha值在公式中是1，不会导致偏差</li></ul></li> <li>所以，需要将字符串的数据按每三个一个像素的方式进行存储</li> <li>字符串数据的长度可能不能被三整除，需要补位。具体做法是，补位的通道值都设置成255。将像素数据的第一个值，定义为消息位，r通道值为补位像素个数。解码的时候读了第一个像素的r通道值后存下来，到遍历的最后一个时，只取对应的有效值就行。</li></ul> <h4 id="canvas绘图的尺寸设定"><a href="#canvas绘图的尺寸设定" class="header-anchor">#</a> canvas绘图的尺寸设定</h4> <p>canvas生成图片的要求是<code>传入的像素素组长度 = 4 * 图片宽度 * 图片高度</code>。<br>
所以预设一个最大的图片宽度，然后穷举，从最大开始依次减小，长度/4/宽度，得到的是个整数，就认为是个合法的宽高了。<br>
致命缺点：如果长度刚好是个质数，就莫法了，只能手动加个像素，并且在第一个像素的g通道标示。<br>
利用canvas绘图api，传入图片信息，设定的尺寸，进行绘图</p> <h3 id="解析生成的图片为字符串"><a href="#解析生成的图片为字符串" class="header-anchor">#</a> 解析生成的图片为字符串</h3> <ul><li>获取上传图片的二进制值，
<ul><li>添加上传事件的监听，获取到file对象，传入fileReader
<ul><li>如果是文本/json，readAsText；</li> <li>如果是图片，readAsDataURL，</li></ul></li> <li>传入新增加img对象中，监听onload事件，读url，获取到上传图片的base64值</li> <li>传入canvas的drawImage，读canvas数据，得到二进制值</li></ul></li> <li>像素值转字符串
<ul><li>PixToData<div class="language-js extra-class"><pre class="language-js"><code><span class="token function">PixToData</span><span class="token punctuation">(</span><span class="token parameter">pixList</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> lastCount<span class="token punctuation">;</span>
  <span class="token keyword">let</span> res <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> pixList<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i <span class="token operator">+=</span> <span class="token number">4</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>i <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// 补位像素的提示像素</span>
      lastCount <span class="token operator">=</span> pixList<span class="token punctuation">[</span>i<span class="token punctuation">]</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>i <span class="token operator">===</span> pixList<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">4</span> <span class="token operator">&amp;&amp;</span> lastCount <span class="token operator">!==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> lastCount<span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        res<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>pixList<span class="token punctuation">[</span>i <span class="token operator">+</span> j<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      res<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>pixList<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> pixList<span class="token punctuation">[</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> pixList<span class="token punctuation">[</span>i <span class="token operator">+</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> res<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div></li> <li>Utf8ArrayToString<div class="language-js extra-class"><pre class="language-js"><code><span class="token function">Utf8ArrayToString</span><span class="token punctuation">(</span><span class="token parameter">list</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> res <span class="token operator">=</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">;</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> list<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> e <span class="token operator">=</span> list<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> byte <span class="token operator">=</span> e<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>byte<span class="token punctuation">.</span>length <span class="token operator">&lt;</span> <span class="token number">8</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// 单字节</span>
      res <span class="token operator">+=</span> String<span class="token punctuation">.</span><span class="token function">fromCodePoint</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      <span class="token keyword">let</span> count <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
      <span class="token comment">// 根据第一个字节的二进制编码中首位1的个数，获取到该字符需要几个字节</span>
      <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> byte<span class="token punctuation">.</span>length<span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> b <span class="token operator">=</span> byte<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>b <span class="token operator">===</span> <span class="token string">&quot;1&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">continue</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
          count <span class="token operator">=</span> j<span class="token punctuation">;</span>
          <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>count <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">let</span> tmp <span class="token operator">=</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> k <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> k <span class="token operator">&lt;</span> count<span class="token punctuation">;</span> k<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          tmp <span class="token operator">+=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">%</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>list<span class="token punctuation">[</span>i <span class="token operator">+</span> k<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span>
        <span class="token punctuation">}</span>
        <span class="token operator">!</span><span class="token operator">!</span>tmp <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>res <span class="token operator">+=</span> <span class="token function">decodeURI</span><span class="token punctuation">(</span>tmp<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        i <span class="token operator">+=</span> <span class="token punctuation">(</span>count <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        res <span class="token operator">+=</span> String<span class="token punctuation">.</span><span class="token function">fromCodePoint</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> res<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li>把每个数据转成二进制，补到8位</li> <li>根据字节的首位1的数量，获取到该字符是由几个字节组成</li> <li>把对应的字转成16进制，拼到一起，<code>decodeURI</code></li> <li>单字节直接<code>fromCodePoint</code></li></ul></li></ul></li></ul></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">12/17/2019, 7:03:57 AM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/note/计算机基础.html" class="prev">
        计算机基础
      </a></span> <span class="next"><a href="/note/Css.html">
        Css
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/note/assets/js/app.2e5e5d15.js" defer></script><script src="/note/assets/js/2.0d9fcc6c.js" defer></script><script src="/note/assets/js/18.984bce13.js" defer></script>
  </body>
</html>
